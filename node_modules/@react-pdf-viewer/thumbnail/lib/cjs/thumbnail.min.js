"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=a(e),i=function(a){var i=a.page,r=a.pageHeight,u=a.pageWidth,o=a.rotation,c=a.thumbnailHeight,l=a.thumbnailWidth,g=e.useRef(),d=e.useState(""),s=d[0],h=d[1];return e.useEffect((function(){var e=g.current;e&&e.cancel();var t=document.createElement("canvas"),a=t.getContext("2d",{alpha:!1}),n=l,c=n/(u/r),d=n/u;t.height=c,t.width=n,t.style.height=c+"px",t.style.width=n+"px";var s=i.getViewport({rotation:o,scale:d});g.current=i.render({canvasContext:a,viewport:s}),g.current.promise.then((function(){return h(t.toDataURL())}),(function(){}))}),[o]),s?n.default.createElement("img",{src:s,height:c+"px",width:l+"px"}):n.default.createElement(t.Spinner,null)},r=function(a){var r=a.doc,u=a.pageHeight,o=a.pageIndex,c=a.pageWidth,l=a.rotation,g=e.useState({height:u,isCalculated:!1,page:null,viewportRotation:0,width:c}),d=g[0],s=g[1],h=d.isCalculated,p=d.page,f=d.height,m=d.width,b=m/f,v=Math.abs(l)%180==0,E=v?100:100/b,w=v?100/b:100,P=(l+d.viewportRotation)%360;return n.default.createElement(t.Observer,{onVisibilityChanged:function(e){e.isVisible&&!h&&r.getPage(o+1).then((function(e){var t=e.getViewport({scale:1});s({height:t.height,isCalculated:!0,page:e,viewportRotation:t.rotation,width:t.width})}))}},n.default.createElement("div",{className:"rpv-thumbnail-container",style:{height:w+"px",width:E+"px"}},p?n.default.createElement(i,{page:p,pageHeight:v?f:m,pageWidth:v?m:f,rotation:P,thumbnailHeight:w,thumbnailWidth:E}):n.default.createElement(t.Spinner,null)))},u=function(e){var t=e.currentPage,a=e.doc,i=e.pageHeight,u=e.pageWidth,o=e.rotation,c=e.onJumpToPage,l=a.numPages;return n.default.createElement("div",{className:"rpv-thumbnail-list"},Array(l).fill(0).map((function(e,l){var g,d,s;return n.default.createElement("div",{key:"thumbnail-"+l,onClick:function(){return c(l)}},n.default.createElement("div",{className:(g={},g["rpv-thumbnail-item"]=!0,g["rpv-thumbnail-item-selected"]=t===l,d=g,s=[],Object.keys(d).forEach((function(e){e&&d[e]&&s.push(e)})),s.join(" "))},n.default.createElement(r,{doc:a,pageHeight:i,pageIndex:l,pageWidth:u,rotation:o})))})))},o=function(a){var i=a.store,r=e.useState(i.get("doc")),o=r[0],c=r[1],l=e.useState(i.get("currentPage")||0),g=l[0],d=l[1],s=e.useState(i.get("pageHeight")||0),h=s[0],p=s[1],f=e.useState(i.get("pageWidth")||0),m=f[0],b=f[1],v=e.useState(i.get("rotation")||0),E=v[0],w=v[1],P=function(e){d(e)},x=function(e){c(e)},H=function(e){p(e)},W=function(e){b(e)},S=function(e){w(e)};return e.useEffect((function(){return i.subscribe("doc",x),i.subscribe("pageHeight",H),i.subscribe("pageWidth",W),i.subscribe("rotation",S),function(){i.unsubscribe("doc",x),i.unsubscribe("pageHeight",H),i.unsubscribe("pageWidth",W),i.unsubscribe("rotation",S)}}),[]),e.useLayoutEffect((function(){return i.subscribe("currentPage",P),function(){i.unsubscribe("currentPage",P)}}),[]),o?n.default.createElement(u,{currentPage:g,doc:o,pageHeight:h,pageWidth:m,rotation:E,onJumpToPage:function(e){var t=i.get("jumpToPage");t&&t(e)}}):n.default.createElement("div",{className:"rpv-thumbnail-list-loader"},n.default.createElement(t.Spinner,null))};exports.thumbnailPlugin=function(){var e=t.createStore({});return{install:function(t){e.update("jumpToPage",t.jumpToPage)},onDocumentLoad:function(t){e.update("doc",t.doc)},onViewerStateChange:function(t){return e.update("currentPage",t.pageIndex),e.update("pageHeight",t.pageHeight),e.update("pageWidth",t.pageWidth),t},Thumbnails:function(){return n.default.createElement(o,{store:e})}}};
