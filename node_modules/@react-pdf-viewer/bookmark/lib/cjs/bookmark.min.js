"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(e),r=function(t){var n=t.bookmark,r=t.depth,a=t.doc,c=t.onClick,i=t.onJumpToDest,l=e.createRef(),s=e.createRef(),d=e.useRef(!0),f=n.items&&n.items.length>0;return o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:"rpv-bookmark-item",style:{paddingLeft:20*r+4+"px"},onClick:function(){!f&&n.dest&&c(n.dest)}},f&&o.default.createElement("span",{ref:l,className:"rpv-bookmark-toggle",onClick:function(){d.current=!d.current;var e=s.current,t=l.current;e&&t&&(e.style.display=d.current?"block":"none",t.classList.toggle("rpv-bookmark-toggle-expanded"))}},"â–º"),n.url?o.default.createElement("a",{className:"rpv-bookmark-title",href:n.url,rel:"noopener noreferrer nofollow",target:n.newWindow?"_blank":""},n.title):o.default.createElement("div",{className:"rpv-bookmark-title",onClick:function(){f&&n.dest&&c(n.dest)}},n.title)),f&&o.default.createElement("div",{ref:s},o.default.createElement(u,{bookmarks:n.items,depth:r+1,doc:a,onJumpToDest:i})))},a=function(e,n){return new Promise((function(o){new Promise((function(t){"string"==typeof n?e.getDestination(n).then((function(e){t(e)})):t(n)})).then((function(n){e.getPageIndex(n[0]).then((function(e){var r=function(e,n){switch(n[1].name){case"XYZ":return{bottomOffset:n[3],pageIndex:e-1,scaleTo:n[4]};case"Fit":return{bottomOffset:0,pageIndex:e-1,scaleTo:t.SpecialZoomLevel.PageFit};default:return{bottomOffset:0,pageIndex:e-1,scaleTo:1}}}(e,n);o(r)}))}))}))},u=function(e){var t=e.bookmarks,n=e.depth,u=void 0===n?0:n,c=e.doc,i=e.onJumpToDest,l=function(e){a(c,e).then((function(e){var t=e.pageIndex,n=e.bottomOffset,o=e.scaleTo;i(t+1,n,o)}))};return o.default.createElement("ul",{className:"rpv-bookmark-list"},t.map((function(e,t){return o.default.createElement("li",{key:t},o.default.createElement(r,{bookmark:e,depth:u,doc:c,onClick:l,onJumpToDest:i}))})))},c=function(n){var r=n.doc,a=n.onJumpToDest,c=e.useContext(t.LocalizationContext),i=e.useState({isLoaded:!1,items:[]}),l=i[0],s=i[1];return e.useEffect((function(){s({isLoaded:!1,items:[]}),r.getOutline().then((function(e){s({isLoaded:!0,items:e||[]})}))}),[r]),l.isLoaded?0===l.items.length?o.default.createElement("div",{className:"rpv-bookmark-empty"},c&&c.bookmark?c.bookmark.noBookmark:"There is no bookmark"):o.default.createElement(u,{bookmarks:l.items,depth:0,doc:r,onJumpToDest:a}):o.default.createElement(t.Spinner,null)},i=function(n){var r=n.store,a=e.useState(r.get("doc")),u=a[0],i=a[1],l=function(e){i(e)};return e.useEffect((function(){return r.subscribe("doc",l),function(){r.unsubscribe("doc",l)}}),[]),u?o.default.createElement(c,{doc:u,onJumpToDest:function(e,t,n){var o=r.get("jumpToDestination");o&&o(e,t,0,n)}}):o.default.createElement("div",{className:"rpv-bookmark-list-loader"},o.default.createElement(t.Spinner,null))};exports.bookmarkPlugin=function(){var e=t.createStore({});return{install:function(t){e.update("jumpToDestination",t.jumpToDestination)},onDocumentLoad:function(t){e.update("doc",t.doc)},Bookmarks:function(){return o.default.createElement(i,{store:e})}}};
